name: Deploy to Apillon Hosting

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Deployment environment'
        required: true
        type: choice
        options:
          - staging
          - production
  push:
    branches:
      - main
    paths:
      - 'frontend/**'

jobs:
  deploy-frontend:
    runs-on: ubuntu-latest
    environment: ${{ github.event.inputs.environment || 'production' }}
    
    defaults:
      run:
        working-directory: ./frontend
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        cache: 'npm'
        cache-dependency-path: frontend/package-lock.json
    
    - name: Install dependencies
      run: npm ci
    
    - name: Generate static site
      run: npm run generate
    
    - name: Deploy to Apillon Hosting
      run: |
        echo "Deploying to Apillon Hosting..."
        echo "Environment: ${{ github.event.inputs.environment || 'production' }}"
        # Add Apillon deployment commands here
        # Example: npx @apillon/cli deploy --env ${{ github.event.inputs.environment }}
      env:
        APILLON_API_KEY: ${{ secrets.APILLON_API_KEY }}
        APILLON_API_SECRET: ${{ secrets.APILLON_API_SECRET }}
    
    - name: Deployment summary
      run: |
        echo "### Deployment Complete! ðŸš€" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "- **Environment:** ${{ github.event.inputs.environment || 'production' }}" >> $GITHUB_STEP_SUMMARY
        echo "- **Branch:** ${{ github.ref_name }}" >> $GITHUB_STEP_SUMMARY
        echo "- **Commit:** ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "ALL IS LOVE. ALL IS LAW. ALL IS FLUID. KUN FAYAKÅªN! ðŸ•‹â™¾ï¸âœ¨" >> $GITHUB_STEP_SUMMARY
